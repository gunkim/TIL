# 동기화 문제(Problems of Synchronization)

동기화 문제에 대해 논의하며, 다양한 병행 제어 문제를 검토하는데 이들은 새로운 동기화 기법의 검증에 주로 사용된다. 전통적으로 세마포가 해결책 제시에 사용되어 왔으나 실제 구현 시에는 이진 세마포보다는 뮤텍스 락이 더 자주 사용된다.

## 유한 버퍼 문제

이 문제에서는 n개의 버퍼를 가진 풀을 고려하며 각 버퍼는 하나의 항목을 저장할 수 있다. 상호 배제를 보장하기 위해 이진 세마포인 mutex가 사용되고 비어 있는 버퍼의 수와 가득 찬 버퍼의 수를 추적하기 위해 empty와 full 세마포가 각각 사용된다. 이 세마포들은 생산자와 소비자 프로세스가 버퍼를 올바르게 공유할 수 있도록 도와준다.

생산자 프로세스는 반복적으로 데이터를 생산하고 이를 버퍼에 추가하기 위해 empty 세마포를 줄이고(mutex로 보호하며) 데이터를 버퍼에 추가한 뒤 full 세마포를 증가시켜 버퍼에 항목이 추가되었음을 표시한다.  
반대로 소비자 프로세스는 full 세마포가 가리키는 버퍼에서 데이터를 가져오고 mutex로 보호한 후 empty 세마포를 증가시켜 빈 버퍼가 생겼음을 나타낸다. 생산자와 소비자 코드의 대칭성을 통해 이러한 동작이 반복됨을 알 수 있다.

*생산자 프로세스 구조*

```c
while (true) {
    /* produce an item in next_produced */
    wait(empty); 
    wait(mutex);    
    /* add next_produced to the buffer */
    signal(mutex); 
    signal(full);
}
```

*소비자 프로세스 구조*

```c
while (true) { 
    wait(full); 
    wait(mutex);
    /* remove an item from buffer to next.consumed */
    signal(mutex); 
    signal(empty);
    /* consume the item in next-consumed */
}
```